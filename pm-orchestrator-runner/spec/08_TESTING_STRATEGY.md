# Testing Strategy

本章は PM Orchestrator Runner の実装および変更に対して必須となるテスト要件を定義する。
本章に記載されたテストが満たされない場合、当該実装は仕様違反とみなされる。

テスト未実施、テスト失敗、カバレッジ未達の状態での実装完了判定は禁止される。

## Dual Testing Approach

Runner は単体テストとプロパティベーステストの両方を必ず実装しなければならない。
いずれか一方のみの実施は認められない。

## Unit Testing

単体テストは以下の観点を必ず網羅しなければならない。

正しい挙動を示す具体例  
境界条件および異常系  
コンポーネント間の統合ポイント  
設定ファイル検証シナリオ  
CLI インターフェースの挙動

単体テストは仕様書の各章に対応付けられていなければならない。

## Property Based Testing

プロパティベーステストは fast-check を用いて実装しなければならない。

各プロパティテストは、すべての入力に対して成り立つ性質を検証しなければならない。
各テストは最低 100 回以上の試行を行わなければならない。
各テストは対応する Correctness Property 番号を明示しなければならない。
並列実行および競合状態を含めなければならない。
証跡破損および証跡欠損時の挙動を含めなければならない。

## Property Test Execution Rules

各 Property テストは Feature 名を pm-orchestrator-runner として実装しなければならない。
対象 Property 番号をコメントとして明示しなければならない。
テスト失敗時は即座に失敗と判定されなければならない。

試行回数を減らすことは禁止される。

## Coverage Requirements

Runner のテストカバレッジは以下を必ず満たさなければならない。

P0 要件については行カバレッジ 90 パーセント以上、分岐カバレッジ 85 パーセント以上とする。
P1 要件については行カバレッジ 80 パーセント以上、分岐カバレッジ 75 パーセント以上とする。

カバレッジ測定には nyc または istanbul を使用する。
測定対象は pm-orchestrator-runner/src のみとする。

テストコードおよび自動生成コードは測定対象外とする。

CI パイプラインは、カバレッジ未達時に必ず失敗しなければならない。

## Integration Testing

以下の統合テストは必須である。

Claude Code CLI と executor-only mode の統合  
並列実行下でのファイルシステム操作  
失敗ケースを含む証跡収集処理  
不正または破損した設定ファイルの検証  
セッション再起動および再開シナリオ

統合テストが失敗した場合、実装は完了とみなしてはならない。

## Test Data Management

テストデータは現実的な入力を生成するジェネレータを使用しなければならない。
境界値を生成するジェネレータを含めなければならない。
失敗条件を意図的に生成するジェネレータを含めなければならない。
設定ファイル検証用ジェネレータを含めなければならない。
証跡整合性検証用ジェネレータを含めなければならない。

手書きの固定データのみに依存するテストは禁止される。

## Testing Discipline

Runner 自身は、Runner が強制する TDD 規律を必ず自己適用しなければならない。

テストが失敗している状態での実装継続は禁止される。
テストが存在しない機能の実装は禁止される。
