# Claude Code Configuration for AI Scripts Repository

## プロジェクト概要

このリポジトリは、AI開発を支援するための品質管理スクリプト集です。

### 主要コンポーネント

- **quality-guardian/**: 統合品質管理システム
- **legacy/**: 旧バージョンのスクリプト
- **tools/**: 各種ユーティリティ

## Quality Guardian 開発ルール

### バージョン管理の厳守

**すべてのコード変更時は必ず以下を実行すること:**

1. **バージョンアップ必須**
   - `quality-guardian/VERSION` ファイルを更新
   - `quality-guardian/install.sh` 内の version を更新
   - `quality-guardian/quality-guardian.js` 内の version を更新
   - セマンティックバージョニングに従う（例: 1.2.1 → 1.2.2）

2. **README.md の更新必須**
   - `quality-guardian/README.md` を必ず確認・更新
   - 新機能追加時は必ず README に記載
   - 変更内容を明確に説明

3. **変更前の確認フロー**
   ```bash
   # 1. README.mdを読んで現在の仕様を確認
   cat quality-guardian/README.md

   # 2. 現在のバージョンを確認
   cat quality-guardian/VERSION

   # 3. 変更実施

   # 4. バージョン更新（3箇所すべて）
   # - quality-guardian/VERSION
   # - quality-guardian/install.sh (version: "x.x.x")
   # - quality-guardian/quality-guardian.js (version: 'x.x.x')

   # 5. README更新
   ```

### 禁止事項

❌ **絶対にやってはいけないこと:**

- README.md を読まずにコード変更
- バージョンアップせずにコード変更
- ユーザーへの確認なしでの破壊的変更
- バックアップなしでの重要な変更

### ファイル構成

```
/Users/masa/dev/ai/scripts/
├── .claude/
│   └── CLAUDE.md          # この設定ファイル
├── quality-guardian/
│   ├── VERSION            # バージョン番号（現在: 1.2.2）
│   ├── README.md          # 必読ドキュメント
│   ├── install.sh         # インストーラー
│   ├── quality-guardian.js # メインスクリプト
│   ├── modules/           # 各種モジュール
│   └── INTEGRATION.md     # 統合ガイド
├── legacy/                # 旧スクリプト
├── tools/                 # ユーティリティ
└── README.md              # リポジトリ全体の説明
```

### コーディング規約

- **シェルスクリプト**: bashの慣習に従う、set -e で エラー時即座に終了
- **JavaScript**: CommonJS形式、Node.js標準モジュール優先
- **エラーハンドリング**: すべてのエラーに適切なメッセージ
- **ユーザー通知**: 絵文字を使って分かりやすく（🚀✅❌⚠️💡）

### 開発時の心構え

1. **品質管理ツールの開発者として**
   - 自分自身が作るコードも高品質であるべき
   - ユーザーが期待する動作を正確に実現
   - 予期しない動作は絶対に避ける

2. **ドキュメント優先**
   - README.md は常に最新の状態に
   - 変更履歴を明確に記録
   - ユーザーが困らない説明を心がける

3. **後方互換性の維持**
   - 既存の動作を壊さない
   - 破壊的変更は必ず事前確認

### AI開発時の特記事項

このプロジェクト自体が「AI開発の品質を守る」ツールなので、
**開発者（AI）自身がルールを厳守すること**が極めて重要です。

- バージョン管理を忘れない
- READMEを必ず読む・更新する
- ユーザーの意図を正確に理解する
- 勝手な改変をしない

## ⚠️ 重要な数値

**サブエージェント数**: 必ず**11個**です
- 33個や他の数値は誤り
- `.claude/agents/`内のファイル数を確認する場合は`ls -1 .claude/agents/ | wc -l`を実行
- 検証時に誤ったカウントをしないよう注意

## 🎯 AI開発の必須ルール（厳守）

### 1. 問題の再発防止
問題が起きた時は、**言葉だけではなく、具体的に再発防止ができる方法で改善**してください。
- チェックリストの追加
- 自動化スクリプトの作成
- バリデーションの追加
- テストケースの追加

### 2. コミット署名の禁止（🚨 とても重要）
Pull RequestやCommitをする際、**Claudeが作成したことが分からないように勝手に署名などを付加しないでください**。

❌ 禁止例:
```
Co-Authored-By: Claude <noreply@anthropic.com>
🤖 Generated with [Claude Code](https://claude.com/claude-code)
```

✅ 正しい例:
```
git commit -m "feat: Add new feature"
```

### 3. タスク完了時の状態保存
タスクの完了時には、**続きから再開できるように**しておいてください。

再開方法をユーザーに伝える:
- 「次回は『続きをお願いします』と言えば作業を再開できます」
- 「次回は『[具体的なタスク名]の続き』と言えば続きが開始できます」
- 作業途中のファイルパスやコマンドを明示
- 次のステップを明確に記載

### 4. タスクの完遂
できるタスクは**どんどん進めてください**。

重要な原則:
- ⏱️ 時間がかかっても良い
- 🏆 品質を重視
- 🚫 ズルをしない
- ✅ できるタスクを最後までやり切る

### 5. テストはPlaywrightで実施
テストは**curlではなくPlaywright**を使用してください。

必須の確認項目:
- ✅ Playwrightでスクリーンショット確認
- ✅ console.logを確認
- ✅ 実際のブラウザ動作を確認

### 6. 同様の問題の全体確認
同様の問題を見つけた際、**プロジェクト全体で同じパターンがないか必ず確認**してください。

- Grepツールで類似パターンを検索
- 同じコードパターンを全て修正
- 一箇所だけの修正で終わらない

### 7. 開発フローの厳守
各段階で以下を実施してください:

**開発前:**
1. 設計書の作成
2. テスト計画書の作成

**開発中:**
3. **必ず**テストを先に書く（TDD）
4. 実装

**開発後:**
5. テスト確認
6. **必ず**E2Eテストで動作確認
7. テストが通ることを確認
8. Commit
9. 次のタスクへ（確認を待たない）

### 8. 途中報告の禁止
「タスクはどんどん進めてください」と指示された場合、**絶対に途中で報告しない**。

- 完了するまで作業を続ける
- 最後にまとめて報告

### 9. ユーザー指示の厳守
ユーザーの指示は**一字一句守る**。

- 勝手に解釈しない
- 追加機能を勝手に付けない
- 指示された通りに実装

### 10. テストファーストの徹底
**必ず**テストを先に書く。

実装前にテストコードを作成:
```
1. テスト作成（失敗することを確認）
2. 実装
3. テスト成功を確認
```

### 11. E2Eテストによる動作確認
実装を渡す前に**必ず**E2Eテストで動作確認する。

- 実際にブラウザで動作確認
- スクリーンショットで視覚的に確認
- エラーがないことを確認

### 12. 絵文字の禁止
ドキュメントやコミットメッセージに**絵文字を使わない**。

❌ 禁止例:
```
# ドキュメント
✅ インストール完了
🚀 新機能追加
📝 ドキュメント更新

# コミットメッセージ
feat: Add new feature 🎉
fix: Fix bug 🐛
```

✅ 正しい例:
```
# ドキュメント
[OK] インストール完了
[NEW] 新機能追加
[DOC] ドキュメント更新

# コミットメッセージ
feat: Add new feature
fix: Fix bug
```

**理由**:
- 絵文字は環境によって表示が異なる
- テキスト検索がしづらい
- プロフェッショナルな文書には不適切

### 13. 日本語での応答を厳守
必ず日本語で応答する。英語で返答しない。

**理由**:
- ユーザーが日本人で、日本語での応答を期待している
- コミュニケーションの正確性を保つため
- 誤解を防ぐため

## 🚨 機能削除・移行時の必須確認（絶対厳守）

**LLMは「徹底する」と約束できません。システム的に強制するため、このチェックリストを必ず実行すること：**

### 削除前の必須確認（すべて完了するまで削除禁止）

- [ ] **削除する機能の全コードを Read ツールで確認した**
- [ ] **その機能を使っている箇所を Grep ツールで全検索した**
- [ ] **移行先を明確に決定した（どのファイルのどの場所か）**
- [ ] **ユーザーに削除理由と移行先を説明し、承認を得た**
- [ ] **TodoWrite ツールで「機能削除」タスクを作成し、進捗を追跡している**

### 移行時の必須確認（すべて完了するまでコミット禁止）

- [ ] **移行前の機能リストを作成した（箇条書きで）**
- [ ] **移行後の機能リストを作成した（箇条書きで）**
- [ ] **両方を比較して、漏れがないことを確認した**
- [ ] **移行先で実際に動作することをテストした**
- [ ] **移行完了をユーザーに報告した（機能リストを添えて）**

### コミット前の最終確認（すべて完了するまでコミット禁止）

- [ ] **git diff で削除したコードを全て確認した**
- [ ] **削除された各機能が移行先に存在することを確認した**
- [ ] **コミットメッセージに「削除」ではなく「移行」と書いた**
- [ ] **バージョンを更新した（3箇所：VERSION, install.sh, quality-guardian.js）**
- [ ] **README.md に変更内容を記載した**

### ❌ このチェックリストを完了せずに機能を削除してはいけない

**過去の失敗例：**
- カスタムコマンド `/quality-check` のバージョン管理機能を削除
- install.sh への移行を忘れた
- ユーザーが「機能が勝手に切れた」と指摘
- 「徹底します」と約束したが、LLMには不可能

**再発防止策：**
- このチェックリストを毎回実行
- TodoWrite ツールで進捗管理
- 機能削除時は必ず Todo に記録
- すべてのチェックが完了するまで次に進まない

---

**Current Version: 1.2.19**
**Last Updated: 2025-10-17**
