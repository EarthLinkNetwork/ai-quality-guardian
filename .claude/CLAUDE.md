# Claude Code Configuration for AI Scripts Repository

## プロジェクト概要

このリポジトリは、AI開発を支援するための品質管理スクリプト集です。

### 主要コンポーネント

- **quality-guardian/**: 統合品質管理システム
- **legacy/**: 旧バージョンのスクリプト
- **tools/**: 各種ユーティリティ

## Quality Guardian 開発ルール

### バージョン管理の厳守

**すべてのコード変更時は必ず以下を実行すること:**

1. **バージョンアップ必須**
   - `quality-guardian/VERSION` ファイルを更新
   - `quality-guardian/install.sh` 内の version を更新
   - `quality-guardian/quality-guardian.js` 内の version を更新
   - セマンティックバージョニングに従う（例: 1.2.1 → 1.2.2）

2. **README.md の更新必須**
   - `quality-guardian/README.md` を必ず確認・更新
   - 新機能追加時は必ず README に記載
   - 変更内容を明確に説明

3. **変更前の確認フロー**
   ```bash
   # 1. README.mdを読んで現在の仕様を確認
   cat quality-guardian/README.md

   # 2. 現在のバージョンを確認
   cat quality-guardian/VERSION

   # 3. 変更実施

   # 4. バージョン更新（3箇所すべて）
   # - quality-guardian/VERSION
   # - quality-guardian/install.sh (version: "x.x.x")
   # - quality-guardian/quality-guardian.js (version: 'x.x.x')

   # 5. README更新
   ```

### 禁止事項

❌ **絶対にやってはいけないこと:**

- README.md を読まずにコード変更
- バージョンアップせずにコード変更
- ユーザーへの確認なしでの破壊的変更
- バックアップなしでの重要な変更

### ファイル構成

```
/Users/masa/dev/ai/scripts/
├── .claude/
│   └── CLAUDE.md          # この設定ファイル
├── quality-guardian/
│   ├── VERSION            # バージョン番号（現在: 1.2.2）
│   ├── README.md          # 必読ドキュメント
│   ├── install.sh         # インストーラー
│   ├── quality-guardian.js # メインスクリプト
│   ├── modules/           # 各種モジュール
│   └── INTEGRATION.md     # 統合ガイド
├── legacy/                # 旧スクリプト
├── tools/                 # ユーティリティ
└── README.md              # リポジトリ全体の説明
```

### コーディング規約

- **シェルスクリプト**: bashの慣習に従う、set -e で エラー時即座に終了
- **JavaScript**: CommonJS形式、Node.js標準モジュール優先
- **エラーハンドリング**: すべてのエラーに適切なメッセージ
- **ユーザー通知**: 絵文字を使って分かりやすく（🚀✅❌⚠️💡）

### 開発時の心構え

1. **品質管理ツールの開発者として**
   - 自分自身が作るコードも高品質であるべき
   - ユーザーが期待する動作を正確に実現
   - 予期しない動作は絶対に避ける

2. **ドキュメント優先**
   - README.md は常に最新の状態に
   - 変更履歴を明確に記録
   - ユーザーが困らない説明を心がける

3. **後方互換性の維持**
   - 既存の動作を壊さない
   - 破壊的変更は必ず事前確認

### AI開発時の特記事項

このプロジェクト自体が「AI開発の品質を守る」ツールなので、
**開発者（AI）自身がルールを厳守すること**が極めて重要です。

- バージョン管理を忘れない
- READMEを必ず読む・更新する
- ユーザーの意図を正確に理解する
- 勝手な改変をしない

## ⚠️ 重要な数値

**サブエージェント数**: 必ず**11個**です
- 33個や他の数値は誤り
- `.claude/agents/`内のファイル数を確認する場合は`ls -1 .claude/agents/ | wc -l`を実行
- 検証時に誤ったカウントをしないよう注意

## 🎯 AI開発の必須ルール（厳守）

### 1. 問題の再発防止
問題が起きた時は、**言葉だけではなく、具体的に再発防止ができる方法で改善**してください。
- チェックリストの追加
- 自動化スクリプトの作成
- バリデーションの追加
- テストケースの追加

### 2. コミット署名の禁止（🚨 とても重要）
Pull RequestやCommitをする際、**Claudeが作成したことが分からないように勝手に署名などを付加しないでください**。

❌ 禁止例:
```
Co-Authored-By: Claude <noreply@anthropic.com>
🤖 Generated with [Claude Code](https://claude.com/claude-code)
```

✅ 正しい例:
```
git commit -m "feat: Add new feature"
```

### 3. タスク完了時の状態保存
タスクの完了時には、**続きから再開できるように**しておいてください。

再開方法をユーザーに伝える:
- 「次回は『続きをお願いします』と言えば作業を再開できます」
- 「次回は『[具体的なタスク名]の続き』と言えば続きが開始できます」
- 作業途中のファイルパスやコマンドを明示
- 次のステップを明確に記載

### 4. タスクの完遂
できるタスクは**どんどん進めてください**。

重要な原則:
- ⏱️ 時間がかかっても良い
- 🏆 品質を重視
- 🚫 ズルをしない
- ✅ できるタスクを最後までやり切る

### 5. テストはPlaywrightで実施
テストは**curlではなくPlaywright**を使用してください。

必須の確認項目:
- ✅ Playwrightでスクリーンショット確認
- ✅ console.logを確認
- ✅ 実際のブラウザ動作を確認

### 6. 同様の問題の全体確認
同様の問題を見つけた際、**プロジェクト全体で同じパターンがないか必ず確認**してください。

- Grepツールで類似パターンを検索
- 同じコードパターンを全て修正
- 一箇所だけの修正で終わらない

### 7. 開発フローの厳守
各段階で以下を実施してください:

**開発前:**
1. 設計書の作成
2. テスト計画書の作成

**開発中:**
3. **必ず**テストを先に書く（TDD）
4. 実装

**開発後:**
5. テスト確認
6. **必ず**E2Eテストで動作確認
7. テストが通ることを確認
8. Commit
9. 次のタスクへ（確認を待たない）

### 8. 途中報告の禁止
「タスクはどんどん進めてください」と指示された場合、**絶対に途中で報告しない**。

- 完了するまで作業を続ける
- 最後にまとめて報告

### 9. ユーザー指示の厳守
ユーザーの指示は**一字一句守る**。

- 勝手に解釈しない
- 追加機能を勝手に付けない
- 指示された通りに実装

### 10. テストファーストの徹底
**必ず**テストを先に書く。

実装前にテストコードを作成:
```
1. テスト作成（失敗することを確認）
2. 実装
3. テスト成功を確認
```

### 11. E2Eテストによる動作確認
実装を渡す前に**必ず**E2Eテストで動作確認する。

- 実際にブラウザで動作確認
- スクリーンショットで視覚的に確認
- エラーがないことを確認

### 12. 絵文字の禁止
ドキュメントやコミットメッセージに**絵文字を使わない**。

❌ 禁止例:
```
# ドキュメント
✅ インストール完了
🚀 新機能追加
📝 ドキュメント更新

# コミットメッセージ
feat: Add new feature 🎉
fix: Fix bug 🐛
```

✅ 正しい例:
```
# ドキュメント
[OK] インストール完了
[NEW] 新機能追加
[DOC] ドキュメント更新

# コミットメッセージ
feat: Add new feature
fix: Fix bug
```

**理由**:
- 絵文字は環境によって表示が異なる
- テキスト検索がしづらい
- プロフェッショナルな文書には不適切

### 13. 日本語での応答を厳守
必ず日本語で応答する。英語で返答しない。

**理由**:
- ユーザーが日本人で、日本語での応答を期待している
- コミュニケーションの正確性を保つため
- 誤解を防ぐため

### 14. テストエラーの完全解決とスキップの絶対禁止（絶対厳守）
テストでエラーが発生した場合、**途中で質問せず、全てのエラーを解決するまで作業を続ける**。

**厳守事項**:
- テストエラー発生時に「続けますか？」と聞かない
- 全てのテストが通るまで修正を続ける
- **テストのスキップ・無効化は絶対禁止**
- **「一時的に」という言葉で正当化してはいけない**
- ズルをして回避しない（例: テストを無効化、expect文を削除等）
- 途中で質問せず、最後まで修正を完了させる

**絶対禁止のパターン**:
```
❌ 「E2Eテストを一時的にスキップ」
❌ test.skip(), it.skip(), xit(), xdescribe()の使用
❌ test.only(), it.only()の使用（デバッグ時を除く）
❌ 「エラーが出ているけど、そのままで」
❌ 「後で直します」
❌ テストの条件を緩める（例: timeout延長、expect削除）
❌ テストそのものを削除
❌ テストコメントアウト
```

**Test First原則の徹底**:
```
1. テストを先に書く（実装前）
2. テストが失敗することを確認（Red）
3. 最小限の実装（Green）
4. リファクタリング（Refactor）
5. すべてのテストが通ることを確認
```

**理由**:
- **テストは全部クリアしないと完全に無意味**
- skipしたテストは存在しないのと同じ
- 「一時的」は永久になる
- Test Firstを守らないとTDDの意味がない
- エラーを放置すると品質が劣化する

**正しい対応**:
```
1. テストを先に書く
2. テスト実行 → 失敗を確認（これが正常）
3. 実装
4. テスト実行 → エラー検出
5. エラー原因を分析
6. コードを修正
7. テスト再実行 → まだエラーがある
8. 引き続き修正
9. テスト再実行 → 全て通過
10. 完了報告
```

**誤った対応**:
```
❌ テスト実行 → エラー検出 → 「続けますか？」と質問
❌ テスト実行 → エラー検出 → 「E2Eテストを一時的にスキップします」
❌ テスト実行 → エラー検出 → テストをskip
❌ テスト実行 → エラー検出 → テストを無効化
❌ テスト実行 → エラー検出 → expect文を削除
❌ テスト実行 → エラー検出 → 「エラーが出ていますがそのままにします」
❌ 実装 → テスト（Test Firstの逆）
```

**Test Firstを守らない場合の問題**:
```
❌ 実装してからテストを書く
   → テストが実装に合わせて書かれる
   → 本来のバグを見逃す
   → テストの意味がない
```

### 15. 大きなタスク単位での完了報告（厳守）
Phase 4-2のようなサブタスクの場合、**大きい項番（Phase 4全体）を完了するまで報告しない**。

**厳守事項**:
- サブタスク（Phase 4-1, 4-2, 4-3等）ごとに報告しない
- 大きな項番（Phase 4全体）が完了してから報告する
- 途中で「Phase 4-1が完了しました」と報告しない
- 全体が終わってから「Phase 4が完了しました」と報告する

**理由**:
- サブタスクごとの報告は無駄なやりとりを増やす
- ユーザーは大きなタスク単位での完了を期待している
- 細かい進捗報告は不要

**正しい対応**:
```
Phase 4: データベース設定
  Phase 4-1: スキーマ作成
  Phase 4-2: マイグレーション実行
  Phase 4-3: テストデータ投入

→ Phase 4-1, 4-2, 4-3を全て完了してから報告
→ 「Phase 4（データベース設定）が完了しました」
```

**誤った対応**:
```
❌ Phase 4-1完了 → 報告 → Phase 4-2実行 → 報告 → Phase 4-3実行 → 報告
✅ Phase 4-1, 4-2, 4-3を全て実行 → Phase 4完了を報告
```

### 16. プロジェクト本体へのフォーカス（絶対厳守）
ユーザーからの質問や「次に何をしたらいいと思いますか」という質問は、**Quality Guardian自体についてではなく、プロジェクト本体について回答する**。

**厳守事項**:
- 「次に何をしたらいいと思いますか」→ プロジェクト本体の次のステップを提案
- 「改善案はありますか」→ プロジェクト本体の改善案を提案
- Quality Guardian設定はあくまで品質管理のツール設定
- ユーザーの関心はプロジェクト本体にある

**理由**:
- Quality Guardian設定が大量にあるため、AIがそちらに引っ張られる
- ユーザーはプロジェクト本体の開発を進めたい
- Quality Guardian自体の改善は求められていない

**正しい対応**:
```
ユーザー: 次に何をしたらいいと思いますか

[プロジェクトが「ECサイト」の場合]
→ 「商品一覧ページの実装を進めるのが良いと思います」
→ 「ユーザー認証機能のテストを追加するのが良いと思います」

❌ 「Quality Guardianのルールを追加するのが良いと思います」
❌ 「install.shの改善を進めるのが良いと思います」
```

**誤った対応**:
```
❌ プロジェクト本体の質問なのに、Quality Guardianの改善案を提案
❌ 「次は何をしますか」に対して、「Quality Guardianの設定を見直しましょう」
```

**明示的にQuality Guardianについて聞かれた場合のみ、Quality Guardianについて回答する**:
```
ユーザー: Quality Guardianに新しいルールを追加したい
→ これはQuality Guardian自体についての質問なので、Quality Guardianについて回答する
```

## 🚨 機能削除・移行時の必須確認（絶対厳守）

**LLMは「徹底する」と約束できません。システム的に強制するため、このチェックリストを必ず実行すること：**

### 削除前の必須確認（すべて完了するまで削除禁止）

- [ ] **削除する機能の全コードを Read ツールで確認した**
- [ ] **その機能を使っている箇所を Grep ツールで全検索した**
- [ ] **移行先を明確に決定した（どのファイルのどの場所か）**
- [ ] **ユーザーに削除理由と移行先を説明し、承認を得た**
- [ ] **TodoWrite ツールで「機能削除」タスクを作成し、進捗を追跡している**

### 移行時の必須確認（すべて完了するまでコミット禁止）

- [ ] **移行前の機能リストを作成した（箇条書きで）**
- [ ] **移行後の機能リストを作成した（箇条書きで）**
- [ ] **両方を比較して、漏れがないことを確認した**
- [ ] **移行先で実際に動作することをテストした**
- [ ] **移行完了をユーザーに報告した（機能リストを添えて）**

### コミット前の最終確認（すべて完了するまでコミット禁止）

- [ ] **git diff で削除したコードを全て確認した**
- [ ] **削除された各機能が移行先に存在することを確認した**
- [ ] **コミットメッセージに「削除」ではなく「移行」と書いた**
- [ ] **バージョンを更新した（3箇所：VERSION, install.sh, quality-guardian.js）**
- [ ] **README.md に変更内容を記載した**

### ❌ このチェックリストを完了せずに機能を削除してはいけない

**過去の失敗例：**
- カスタムコマンド `/quality-check` のバージョン管理機能を削除
- install.sh への移行を忘れた
- ユーザーが「機能が勝手に切れた」と指摘
- 「徹底します」と約束したが、LLMには不可能

**再発防止策：**
- このチェックリストを毎回実行
- TodoWrite ツールで進捗管理
- 機能削除時は必ず Todo に記録
- すべてのチェックが完了するまで次に進まない

---

**Current Version: 1.2.38**
**Last Updated: 2025-10-21**
