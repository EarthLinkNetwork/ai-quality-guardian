# MUST Rule 2: テスト必須

**テストでエラーが発生した場合、全てのエラーを解決するまで作業を続ける。テストのスキップ・無効化は絶対禁止。**

## 厳守事項

- テストエラー発生時に「続けますか？」と聞かない
- 全てのテストが通るまで修正を続ける
- **テストのスキップ・無効化は絶対禁止**
- **「一時的に」という言葉で正当化してはいけない**
- ズルをして回避しない（例: テストを無効化、expect文を削除等）

## 絶対禁止のパターン

```
❌ 「E2Eテストを一時的にスキップ」
❌ test.skip(), it.skip(), xit(), xdescribe()の使用
❌ test.only(), it.only()の使用（デバッグ時を除く）
❌ 「エラーが出ているけど、そのままで」
❌ 「後で直します」
❌ テストの条件を緩める（例: timeout延長、expect削除）
❌ テストそのものを削除
❌ テストコメントアウト
```

## Test First原則の徹底

```
1. テストを先に書く（実装前）
2. テストが失敗することを確認（Red）
3. 最小限の実装（Green）
4. リファクタリング（Refactor）
5. すべてのテストが通ることを確認
```

## 理由

- **テストは全部クリアしないと完全に無意味**
- skipしたテストは存在しないのと同じ
- 「一時的」は永久になる
- Test Firstを守らないとTDDの意味がない

## 正しい対応

```
1. テストを先に書く
2. テスト実行 → 失敗を確認（これが正常）
3. 実装
4. テスト実行 → エラー検出
5. エラー原因を分析
6. コードを修正
7. テスト実行 → まだエラーがある
8. 引き続き修正
9. テスト実行 → 全て通過
10. 完了報告
```

## 修正後の全チェック実行義務

**コード修正後は、lint・test・typecheck・buildの全てを実行して動作確認すること。**

### "一部のチェック通過 ≠ 完了" の原則

**いずれか1つが通過しても、全てをチェックするまで完了ではない**

- 型チェックだけで「完了」と報告しない
- テストだけで「完了」と報告しない
- Lintだけで「完了」と報告しない
- **全て通過してから「完了」と報告**

### 必須手順（順序は問わず、全て実行）

1. **Lintを実行**
   ```bash
   pnpm lint  # または npm run lint
   ```

2. **テストを実行**
   ```bash
   pnpm test  # または npm test
   # 修正したファイルのテストを実際に実行
   ```

3. **型チェックを実行**（TypeScriptプロジェクトの場合）
   ```bash
   pnpm typecheck  # または npm run typecheck
   ```

4. **ビルドを実行**
   ```bash
   pnpm build  # または npm run build
   ```

5. **全て通過してから「完了」と報告**

### 禁止事項

```
❌ 型チェックだけで「完了しました」と報告
❌ テストだけで「完了しました」と報告
❌ Lintだけで「完了しました」と報告
❌ 一部のチェックを省略して「問題なし」と報告
❌ 「おそらく動く」と推測で完了報告
❌ 「lint は通過したので完了」（test/typecheck/buildは？）
```

## 各チェックが検出する問題

**Lint:**
- コードスタイル違反
- ベストプラクティス違反
- 潜在的なバグ（未使用変数、誤った比較等）

**Test:**
- ロジックエラー
- 実行時エラー
- 期待と異なる動作（アサーション失敗）

**TypeCheck:**
- 型の不一致
- 存在しないプロパティへのアクセス
- 引数の数の不一致

**Build:**
- モジュール解決失敗
- ビルド設定エラー
- 依存関係の問題

## 修正後の確認フロー

```bash
# コード修正後は必ず全てを実行

# 1. Lint
pnpm lint
# → Lintエラー: 0件

# 2. Test
pnpm test
# → テスト: 全て通過

# 3. TypeCheck（TypeScriptの場合）
pnpm typecheck
# → 型エラー: 0件

# 4. Build
pnpm build
# → ビルド: 成功

# 5. すべて通過を確認してから報告
echo "lint, test, typecheck, build 全て通過しました"
```

## チェックリスト

**修正完了前に必ず確認:**

- [ ] **lint を実行して通過した**
- [ ] **test を実行して全て通過した**
- [ ] **typecheck を実行して型エラーなし**
- [ ] **build を実行して成功した**
- [ ] **全て通過してから完了報告した**
