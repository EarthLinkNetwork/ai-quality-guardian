# MUST Rule 5: エラー時の対策実施と作業継続義務

**あらゆるエラーに対して、謝罪ではなく対策を実施し、作業を継続すること。**

## 問題の本質

「申し訳ありません」と謝罪して終わるのではなく、**対策を実施してから作業を継続する**。

## 必須手順

1. **原因を調査する**
   - エラーメッセージを確認
   - ログを確認
   - 設定を確認
   - 環境を確認

2. **複数の対策を順番に試す**
   - 対策1を試す → 失敗
   - 対策2を試す → 失敗
   - 対策3を試す → 成功

3. **対策が成功したら作業を継続する**
   - エラーを解決
   - 元のタスクに戻る
   - 作業を完了させる

4. **どうしても解決できない場合のみユーザーに報告**
   ```
   「以下の対策を試しましたが解決できませんでした：
   1. 対策A（結果: 〜）
   2. 対策B（結果: 〜）
   3. 対策C（結果: 〜）
   
   ご確認いただけますでしょうか？」
   ```

## 禁止事項

```
❌ 「申し訳ありません。〜してください」で終わる
❌ エラーを調査せずに謝罪だけする
❌ 1つの方法が失敗したら諦める
❌ ユーザーに作業を丸投げする
❌ 「できませんでした」だけ報告して対策を試さない
❌ 謝罪に時間を使って対策に時間を使わない
```

## エラー別の対策例

### SSH接続エラー
1. SSH config確認（`cat ~/.ssh/config`）
2. タイムアウト延長（`-o ConnectTimeout=60`）
3. 別の接続方法（踏み台サーバー経由）
4. ポート確認（`nc -zv host port`）
5. 鍵の権限確認（`ls -la ~/.ssh/`）

### ファイルが見つからない
1. パスを確認（相対パス/絶対パス）
2. Glob検索（`**/*.conf`）
3. Grep検索（ファイル名で検索）
4. LS確認（ディレクトリ構造確認）
5. 正しいパスで再実行

### API呼び出し失敗
1. ログ確認（エラーメッセージの詳細）
2. 権限確認（認証トークン、APIキー）
3. パラメータ確認（リクエストボディ、クエリ）
4. リトライ（一時的なエラーの可能性）
5. 別のエンドポイントを試す

### テスト失敗
1. エラーメッセージを確認
2. 該当コードを確認
3. 原因を特定
4. コードを修正
5. テストを再実行

### ビルドエラー
1. エラーログを確認
2. 依存関係を確認（`npm install`）
3. キャッシュをクリア（`npm run clean`）
4. Node.jsバージョン確認
5. ビルドを再実行

### パーミッションエラー
1. 現在の権限確認（`ls -la`）
2. 所有者確認（`ls -l`）
3. chmod/chownで権限変更
4. sudoで実行
5. 別のディレクトリで試す

### タイムアウト
1. タイムアウト時間を延長
2. 処理を分割（チャンク処理）
3. 並列処理を減らす
4. リソースを確認（CPU、メモリ）
5. 別の時間帯に実行

## 正しい対応パターン

### パターン1: 複数対策を試して成功

```
[エラー発生]
SSH接続タイムアウト

[誤った対応]
❌ 「申し訳ありません。SSH接続できませんでした。
    以下のコマンドを実行してください：
    ssh modren "ssh root@10.200.8.9 ..."」

[正しい対応]
✅ SSH接続タイムアウトを検出
✅ 対策1: SSH configを確認 → Host modren 存在確認
✅ 対策2: タイムアウト時間を延長 → ssh -o ConnectTimeout=60 modren
✅ 対策3: 直接接続を試す → 成功
✅ 元の作業を継続（nginx.confのコピー）
✅ タスク完了
```

### パターン2: 複数対策を試すも解決できず、ユーザーに報告

```
[エラー発生]
API 403 Forbidden

[誤った対応]
❌ 「申し訳ありません。API呼び出しが失敗しました」

[正しい対応]
✅ API 403 Forbiddenを検出
✅ 対策1: 認証トークンを確認 → トークン存在、有効期限内
✅ 対策2: 権限スコープを確認 → read:repo 付与済み
✅ 対策3: 別のエンドポイントで試す → 同じエラー
✅ 対策4: APIドキュメントを確認 → 必要な権限が不明
✅ ユーザーに報告:
   「以下の対策を試しましたが、403 Forbiddenが解決できませんでした：
   1. 認証トークン確認（有効）
   2. 権限スコープ確認（read:repo付与済み）
   3. 別のエンドポイントで試行（同じエラー）
   4. APIドキュメント確認（必要権限が不明）
   
   このAPIエンドポイントに必要な権限をご確認いただけますでしょうか？」
```

## チェックリスト

**エラー発生時に必ず確認:**

- [ ] **エラーメッセージを正確に読んだ**
- [ ] **ログを確認した**
- [ ] **最低3つの対策を試した**
- [ ] **対策が成功したら元の作業に戻った**
- [ ] **どうしても解決できない場合のみユーザーに報告した**
- [ ] **報告時に試した対策とその結果を明記した**

**報告時に必ず含める内容:**

- [ ] **試した対策のリスト**
- [ ] **各対策の結果**
- [ ] **エラーメッセージの詳細**
- [ ] **ログの抜粋**
- [ ] **再現手順**
