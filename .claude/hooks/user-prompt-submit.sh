#!/bin/bash
# quality-guardianç”¨ user-prompt-submit hook
# åˆ¥ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ­ã‚°ã‚’æ¤œå‡ºã—ã¦ã€ä¿®æ­£ã§ã¯ãªãåˆ†æã‚’ä¿ƒã™

set -e

# å…¥åŠ›ã‚’èª­ã¿å–ã‚‹ï¼ˆJSONå½¢å¼ï¼‰
INPUT=$(cat)

# ãƒ‡ãƒãƒƒã‚°: å—ã‘å–ã£ãŸå…¥åŠ›ã‚’ãƒ­ã‚°ã«å‡ºåŠ›
echo "=== HOOK DEBUG $(date) ===" >> /tmp/quality-guardian-hook-debug.log
echo "$INPUT" >> /tmp/quality-guardian-hook-debug.log

# JSONã‹ã‚‰ prompt ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æŠ½å‡º
USER_MESSAGE=$(echo "$INPUT" | jq -r '.prompt // empty')

# ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ‘ã‚¹ï¼ˆå‹•çš„è§£æ±ºï¼‰
if [ -n "$CLAUDE_PROJECT_DIR" ]; then
    THIS_PROJECT="$CLAUDE_PROJECT_DIR"
else
    # ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: hookã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å ´æ‰€ã‹ã‚‰æ¨æ¸¬
    # .claude/hooks/user-prompt-submit.sh â†’ ../../ï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆï¼‰
    THIS_PROJECT="$(cd "$(dirname "$0")/../.." && pwd)"
fi

# æ¤œå‡ºãƒ‘ã‚¿ãƒ¼ãƒ³
DETECTED=0
CODERABBIT_RESOLVE=0
LIST_MODIFICATION=0
PR_REVIEW_RESPONSE=0

# 1. åˆ¥ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ‘ã‚¹æ¤œå‡º
if echo "$USER_MESSAGE" | grep -qE '(/[a-zA-Z0-9_/.+-]+)' && ! echo "$USER_MESSAGE" | grep -qE "$THIS_PROJECT"; then
  DETECTED=1
fi

# 2. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ»ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼æ¤œå‡º
if echo "$USER_MESSAGE" | grep -qE 'password authentication failed|FATAL.*password|pg_hba.conf|Connection terminated|cloudsqlsuperuser'; then
  DETECTED=1
fi

# 3. Git worktreeé•åæ¤œå‡º
if echo "$USER_MESSAGE" | grep -qE 'git checkout -b|ãƒ–ãƒ©ãƒ³ãƒã¯w[or]ktreeã§å¯¾å¿œ'; then
  DETECTED=1
fi

# 4. Claude Codeå®Ÿè¡Œãƒ­ã‚°æ¤œå‡ºï¼ˆâºãƒãƒ¼ã‚¯ï¼‰
if echo "$USER_MESSAGE" | grep -qE 'âº|Bash\(|Read\(|Edit\(|Write\('; then
  DETECTED=1
fi

# 5. Bitbucket/GitHub URLæ¤œå‡º
if echo "$USER_MESSAGE" | grep -qE 'bitbucket\.org|github\.com.*pull/[0-9]+'; then
  DETECTED=1
fi

# ============================================================================
# ã‚¤ãƒ³ãƒ†ãƒªã‚¸ã‚§ãƒ³ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œå‡ºï¼ˆPhase 1-3: AI Control System Extendedï¼‰
# ============================================================================

# 6. CodeRabbit Resolve Pattern Detection
if echo "$USER_MESSAGE" | grep -qiE 'coderabbit|resolve|resolved|review.*comment|PR.*comment|ãƒ—ãƒ«ãƒªã‚¯.*ã‚³ãƒ¡ãƒ³ãƒˆ'; then
  CODERABBIT_RESOLVE=1
fi

# 7. List Modification Pattern Detection
if echo "$USER_MESSAGE" | grep -qiE 'ãƒãƒ¼ã‚¸ãƒ§ãƒ³.*æ›´æ–°|version.*update|å…¨.*ç®‡æ‰€|5ç®‡æ‰€|ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ|ä¸€è¦§.*ä¿®æ­£|è¤‡æ•°.*ãƒ•ã‚¡ã‚¤ãƒ«.*æ›´æ–°'; then
  LIST_MODIFICATION=1
fi

# 8. PR Review Response Pattern Detection
if echo "$USER_MESSAGE" | grep -qiE 'PR.*ãƒ¬ãƒ“ãƒ¥ãƒ¼|ãƒ—ãƒ«ãƒªã‚¯.*ãƒ¬ãƒ“ãƒ¥ãƒ¼|review.*æŒ‡æ‘˜|ãƒ¬ãƒ“ãƒ¥ãƒ¼.*æŒ‡æ‘˜|å…¨.*æŒ‡æ‘˜.*å¯¾å¿œ|æŒ‡æ‘˜.*æ¼ã‚Œ'; then
  PR_REVIEW_RESPONSE=1
fi

# 9. Complex Implementation Pattern Detectionï¼ˆPhase 9-3è¿½åŠ ï¼‰
COMPLEX_IMPLEMENTATION=0
if echo "$USER_MESSAGE" | grep -qiE 'æ–°æ©Ÿèƒ½|æ–°ã—ã„æ©Ÿèƒ½|ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°|è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«|è¨­è¨ˆ.*å¿…è¦|ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£|å®Ÿè£….*ã—ã¦ãã ã•ã„|æ©Ÿèƒ½.*è¿½åŠ '; then
  COMPLEX_IMPLEMENTATION=1
fi

# 10. Quality Check Pattern Detectionï¼ˆPhase 9-3è¿½åŠ ï¼‰
QUALITY_CHECK=0
if echo "$USER_MESSAGE" | grep -qiE 'å“è³ªãƒã‚§ãƒƒã‚¯|quality.*check|lint.*test|å…¨.*ãƒã‚§ãƒƒã‚¯|æ¤œè¨¼.*å®Ÿè¡Œ|ãƒ†ã‚¹ãƒˆ.*å®Ÿè¡Œ|ãƒ“ãƒ«ãƒ‰.*ç¢ºèª'; then
  QUALITY_CHECK=1
fi

# æ¤œå‡ºæ™‚ã®å¯¾å¿œ
if [ $DETECTED -eq 1 ]; then
  # åˆ¥ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ‘ã‚¹ã‚’æŠ½å‡º
  PROJECT_PATH=$(echo "$USER_MESSAGE" | grep -oE '/[a-zA-Z0-9_/.+-]+' | grep -vE "^$THIS_PROJECT" | head -1 | sed 's:/$::')

  cat <<EOF

ğŸš¨ğŸš¨ğŸš¨ BLOCKER: åˆ¥ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ­ã‚°ã‚’æ¤œå‡ºã—ã¾ã—ãŸ ğŸš¨ğŸš¨ğŸš¨

ã“ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ã¯ã€ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆï¼ˆquality-guardianï¼‰ä»¥å¤–ã®æƒ…å ±ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚

ã€é‡è¦ã€‘
- ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ‘ã‚¹: $THIS_PROJECT
- åˆ¥ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®å•é¡Œã‚’ä¿®æ­£ã—ã¦ã¯ã„ã‘ã¾ã›ã‚“
- AI guardianã¨ã—ã¦åˆ†æã®ã¿è¡Œã£ã¦ãã ã•ã„

ã€æ¤œå‡ºã•ã‚ŒãŸãƒ‘ã‚¿ãƒ¼ãƒ³ã€‘
ä»¥ä¸‹ã®ã„ãšã‚Œã‹ãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸï¼š
- åˆ¥ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ»ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼ï¼ˆpassword authentication failedç­‰ï¼‰
- Git worktreeä½¿ç”¨é•åï¼ˆgit checkout -bç­‰ï¼‰
- Claude Codeå®Ÿè¡Œãƒ­ã‚°ï¼ˆâºãƒãƒ¼ã‚¯ç­‰ï¼‰
- Bitbucket/GitHub URL

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ”´ MUST Rule 0: åˆ¥ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆCLAUDE.mdç¢ºèªç¾©å‹™ï¼ˆæœ€å„ªå…ˆï¼‰
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ã€ä½œæ¥­é–‹å§‹å‰ã«å¿…ãšå®Ÿè¡Œã€‘
EOF

  # åˆ¥ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ‘ã‚¹ãŒç‰¹å®šã§ããŸå ´åˆ
  if [ -n "$PROJECT_PATH" ]; then
    cat <<EOF
1. Read ${PROJECT_PATH}/.claude/CLAUDE.md
   ï¼ˆã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå›ºæœ‰ã®ãƒ«ãƒ¼ãƒ«ãŒè¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹ï¼‰
2. ãƒªãƒã‚¸ãƒˆãƒªä½¿ã„åˆ†ã‘ãƒ«ãƒ¼ãƒ«ã‚’ç¢ºèª
3. é–‹ç™ºãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ç¢ºèª
4. ç¦æ­¢äº‹é …ã‚’ç¢ºèª
5. ä¸Šè¨˜ã®ç¢ºèªå®Œäº†ã‚’å¿œç­”ã§æ˜ç¤º
6. ç¢ºèªå®Œäº†å¾Œã«ä½œæ¥­é–‹å§‹

âŒ CLAUDE.mdç¢ºèªãªã—ã§ä½œæ¥­é–‹å§‹ã¯çµ¶å¯¾ç¦æ­¢
âŒ ã€Œãƒ«ãƒ¼ãƒ«ãŒæ—¢ã«å­˜åœ¨ã—ã¦ã„ã‚‹ã®ã«ç„¡è¦–ã€ã¯é‡å¤§ãªMUST Rule 0é•å

ä¾‹ï¼ˆéå»ã®é•åä¾‹ï¼‰ï¼š
- EarthLinkNetwork/eventsystemã®CLAUDE.mdã«ã€Œindigonote/eventsystemã¯å…¨ã¦çµ‚ã‚ã‚‹ã¾ã§è§¦ã‚‹ãªã€ã¨æ˜è¨˜
- ã—ã‹ã—CLAUDE.mdã‚’ç¢ºèªã›ãšã€indigonote/eventsystemã‚’ç¢ºèªã—ã‚ˆã†ã¨ã—ãŸ
- çµæœï¼šã€Œä½•å›ã„ã£ãŸã‚‰ã€è¨˜æ†¶ã—ã¦ã‚‚ã‚‰ãˆã‚‹ã®ã§ã™ã‹?ã€ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰æŒ‡æ‘˜

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ã€æ­£ã—ã„å¯¾å¿œã€‘
1. åˆ¥ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®CLAUDE.mdã‚’ç¢ºèªï¼ˆæœ€å„ªå…ˆï¼‰
2. ã€Œã“ã‚Œã¯åˆ¥ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ­ã‚°ã§ã™ã€ã¨å®£è¨€
3. project-context-guardianã‚’èµ·å‹•ã—ã¦ãƒ«ãƒ¼ãƒ«é•åã‚’åˆ†æ
4. quality-guardianè‡ªä½“ã‚’å¼·åŒ–ï¼ˆãƒ«ãƒ¼ãƒ«è¿½åŠ ã€ã‚µãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæ”¹å–„ï¼‰
5. ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ›´æ–°ã¨ã‚³ãƒŸãƒƒãƒˆ

ã€çµ¶å¯¾ç¦æ­¢ã€‘
âŒ åˆ¥ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿®æ­£
âŒ åˆ¥ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ–ãƒ©ãƒ³ãƒã‚’ä½œæˆ
âŒ åˆ¥ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®å•é¡Œã‚’è§£æ±º
âŒ ã€Œä¿®æ­£ã—ã¾ã™ã€ã¨åå¿œ
âŒ CLAUDE.mdç¢ºèªãªã—ã§ä½œæ¥­é–‹å§‹

EOF
  else
    cat <<'EOF'
1. åˆ¥ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ‘ã‚¹ã‚’ç‰¹å®š
2. ãã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã® .claude/CLAUDE.md ã‚’ç¢ºèª
3. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå›ºæœ‰ã®ãƒ«ãƒ¼ãƒ«ãƒ»åˆ¶ç´„ã‚’ç¢ºèª
4. ä¸Šè¨˜ã®ç¢ºèªå®Œäº†ã‚’å¿œç­”ã§æ˜ç¤º
5. ç¢ºèªå®Œäº†å¾Œã«ä½œæ¥­é–‹å§‹

âŒ CLAUDE.mdç¢ºèªãªã—ã§ä½œæ¥­é–‹å§‹ã¯çµ¶å¯¾ç¦æ­¢

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ã€æ­£ã—ã„å¯¾å¿œã€‘
1. åˆ¥ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®CLAUDE.mdã‚’ç¢ºèªï¼ˆæœ€å„ªå…ˆï¼‰
2. ã€Œã“ã‚Œã¯åˆ¥ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ­ã‚°ã§ã™ã€ã¨å®£è¨€
3. project-context-guardianã‚’èµ·å‹•ã—ã¦ãƒ«ãƒ¼ãƒ«é•åã‚’åˆ†æ
4. quality-guardianè‡ªä½“ã‚’å¼·åŒ–ï¼ˆãƒ«ãƒ¼ãƒ«è¿½åŠ ã€ã‚µãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæ”¹å–„ï¼‰
5. ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ›´æ–°ã¨ã‚³ãƒŸãƒƒãƒˆ

ã€çµ¶å¯¾ç¦æ­¢ã€‘
âŒ åˆ¥ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿®æ­£
âŒ åˆ¥ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ–ãƒ©ãƒ³ãƒã‚’ä½œæˆ
âŒ åˆ¥ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®å•é¡Œã‚’è§£æ±º
âŒ ã€Œä¿®æ­£ã—ã¾ã™ã€ã¨åå¿œ
âŒ CLAUDE.mdç¢ºèªãªã—ã§ä½œæ¥­é–‹å§‹

EOF
  fi
fi

# ============================================================================
# ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ¥ã®å…·ä½“çš„æŒ‡ç¤ºè¡¨ç¤ºï¼ˆAI Control Systemï¼‰
# ============================================================================

# CodeRabbit Resolve Pattern ãŒæ¤œå‡ºã•ã‚ŒãŸå ´åˆ
if [ $CODERABBIT_RESOLVE -eq 1 ]; then
  cat <<'EOF'

ğŸ¯ PATTERN DETECTED: CodeRabbit Resolve

ã€å³åº§ã«å®Ÿè¡Œã™ã¹ãã“ã¨ã€‘
ä¿®æ­£å®Œäº†å¾Œã€gh api graphql ã§ã‚³ãƒ¡ãƒ³ãƒˆã‚’Resolveã™ã‚‹ã€‚èª¬æ˜ä¸è¦ã€‚

# æ‰‹é †1: Thread IDã‚’å–å¾—
gh api graphql -f query='
query {
  repository(owner: "OWNER", name: "REPO") {
    pullRequest(number: PRç•ªå·) {
      reviewThreads(first: 100) {
        nodes {
          id
          isResolved
          comments(first: 1) {
            nodes {
              body
            }
          }
        }
      }
    }
  }
}'

# æ‰‹é †2: Resolveã‚’å®Ÿè¡Œ
gh api graphql -f query='
mutation {
  resolveReviewThread(input: {threadId: "Thread ID"}) {
    thread {
      id
      isResolved
    }
  }
}'

âŒ ç¦æ­¢äº‹é …:
- ã€ŒCodeRabbitãŒè‡ªå‹•ã§Resolveã—ã¾ã™ã€ã¨èª¬æ˜
- ã€Œã§ããªã„å ´åˆã¯ã€ã¨èª¬æ˜
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã€ŒResolveã—ã¦ãã ã•ã„ã€ã¨ä¾é ¼
- @coderabbitai ã«ä¾é ¼ã—ã¦é€ƒã’ã‚‹

âœ… æ­£ã—ã„å¯¾å¿œ:
1. ä¿®æ­£å®Œäº†
2. å³åº§ã« gh api graphql ã§ Resolve
3. ã€ŒResolveã—ã¾ã—ãŸã€ã¨å ±å‘Š
4. èª¬æ˜ä¸è¦ã€å®Ÿè¡Œã®ã¿

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
EOF
fi

# List Modification Pattern ãŒæ¤œå‡ºã•ã‚ŒãŸå ´åˆ
if [ $LIST_MODIFICATION -eq 1 ]; then
  cat <<'EOF'

ğŸ¯ PATTERN DETECTED: List Modification (è¤‡æ•°ç®‡æ‰€ã®æ›´æ–°)

ã€å³åº§ã«å®Ÿè¡Œã™ã¹ãã“ã¨ã€‘
å…¨ç®‡æ‰€ã‚’å…ˆã«ã‚«ã‚¦ãƒ³ãƒˆã€ä¸€æ°—ã«å…¨ã¦å®Œäº†ã€é€”ä¸­ã§åœæ­¢ç¦æ­¢ã€‚

# æ‰‹é †1: å…¨ç®‡æ‰€ã‚’ grep ã§ç¢ºèª
grep -r "æ¤œç´¢å¯¾è±¡" .

# æ‰‹é †2: ä»¶æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
grep -r "æ¤œç´¢å¯¾è±¡" . | wc -l

# æ‰‹é †3: TodoListä½œæˆï¼ˆå…¨ç®‡æ‰€ã‚’åˆ—æŒ™ï¼‰
TodoWrite ã§å…¨ç®‡æ‰€ã‚’ãƒªã‚¹ãƒˆã‚¢ãƒƒãƒ—

# æ‰‹é †4: å…¨ç®‡æ‰€ã‚’ä¸€æ°—ã«æ›´æ–°
for file in $(grep -rl "æ¤œç´¢å¯¾è±¡" .); do
  # å„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›´æ–°
done

# æ‰‹é †5: å…¨ã¦å®Œäº†ã‚’ç¢ºèª
grep -r "æ¤œç´¢å¯¾è±¡" . | wc -l
# â†’ 0ä»¶ã«ãªã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª

âŒ ç¦æ­¢äº‹é …:
- 1ç®‡æ‰€ã ã‘æ›´æ–°ã—ã¦ã€Œå®Œäº†ã—ã¾ã—ãŸã€
- é€”ä¸­ã§ã€Œç¶šã‘ã¾ã™ã‹ï¼Ÿã€ã¨è³ªå•
- ä¸€éƒ¨ã ã‘å¯¾å¿œã—ã¦çµ‚äº†
- ä»¶æ•°ã‚’æ•°ãˆãšã«é–‹å§‹

âœ… æ­£ã—ã„å¯¾å¿œ:
1. grep ã§å…¨ç®‡æ‰€ã‚’ç¢ºèªï¼ˆä»¶æ•°ã‚«ã‚¦ãƒ³ãƒˆï¼‰
2. TodoList ã§å…¨ç®‡æ‰€ã‚’åˆ—æŒ™
3. ä¸€æ°—ã«å…¨ã¦æ›´æ–°
4. å†åº¦ grep ã§0ä»¶ç¢ºèª
5. ã€Œå…¨â—‹ä»¶ã‚’æ›´æ–°ã—ã¾ã—ãŸã€ã¨å ±å‘Š

è©³ç´°: .claude/agents/pr-review-response-guardian.md
MAY Rule 7: ä¸€è¦§ä¿®æ­£ä½œæ¥­ã®å®Œé‚ç¾©å‹™

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
EOF
fi

# PR Review Response Pattern ãŒæ¤œå‡ºã•ã‚ŒãŸå ´åˆ
if [ $PR_REVIEW_RESPONSE -eq 1 ]; then
  cat <<'EOF'

ğŸ¯ PATTERN DETECTED: PR Review Response

ã€å³åº§ã«å®Ÿè¡Œã™ã¹ãã“ã¨ã€‘
å…¨æŒ‡æ‘˜ã‚’TodoListã«ã—ã¦ã€å…¨ã¦å¯¾å¿œå®Œäº†ã¾ã§ç¶™ç¶šã€‚

# æ‰‹é †1: PRã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆã‚’å…¨ã¦å–å¾—
gh pr view PRç•ªå· --comments

# æ‰‹é †2: TodoListä½œæˆï¼ˆå…¨æŒ‡æ‘˜ã‚’åˆ—æŒ™ï¼‰
TodoWrite ã§ä»¥ä¸‹ã‚’ä½œæˆ:
- [ ] æŒ‡æ‘˜1ã®å†…å®¹
- [ ] æŒ‡æ‘˜2ã®å†…å®¹
- [ ] æŒ‡æ‘˜3ã®å†…å®¹
...å…¨ã¦ã®æŒ‡æ‘˜ã‚’åˆ—æŒ™

# æ‰‹é †3: å…¨æŒ‡æ‘˜ã«å¯¾å¿œ
for æŒ‡æ‘˜ in å…¨æŒ‡æ‘˜; do
  # å¯¾å¿œå®Ÿæ–½
  # TodoListæ›´æ–°
done

# æ‰‹é †4: å…¨ã¦å¯¾å¿œå®Œäº†ã‚’ç¢ºèª
TodoList ã§å…¨ã¦ãŒå®Œäº†ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª

# æ‰‹é †5: å„ã‚³ãƒ¡ãƒ³ãƒˆã‚’Resolve
gh api graphql ã§å…¨ã¦ã®threadã‚’Resolve

âŒ ç¦æ­¢äº‹é …:
- ä¸€éƒ¨ã®æŒ‡æ‘˜ã ã‘å¯¾å¿œ
- ã€Œä¸»è¦ãªæŒ‡æ‘˜ã¯å¯¾å¿œã—ã¾ã—ãŸã€
- TodoListãªã—ã§å¯¾å¿œ
- å¯¾å¿œæ¼ã‚ŒãŒã‚ã‚‹ã®ã«ã€Œå®Œäº†ã€

âœ… æ­£ã—ã„å¯¾å¿œ:
1. å…¨æŒ‡æ‘˜ã‚’TodoListã«åˆ—æŒ™
2. å…¨æŒ‡æ‘˜ã«é †ç•ªã«å¯¾å¿œ
3. å¯¾å¿œã”ã¨ã«TodoListæ›´æ–°
4. å…¨ã¦å®Œäº†ã—ã¦ã‹ã‚‰ã€Œå®Œäº†ã€å ±å‘Š
5. å…¨ã‚³ãƒ¡ãƒ³ãƒˆã‚’Resolve

è©³ç´°: .claude/agents/pr-review-response-guardian.md
MUST Rule 14: PRãƒ¬ãƒ“ãƒ¥ãƒ¼æŒ‡æ‘˜ã¸ã®å®Œå…¨å¯¾å¿œç¾©å‹™

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
EOF
fi

# ============================================================================
# PM Orchestrator èµ·å‹•åˆ¤å®šï¼ˆPhase 2-3: AI Control System Extendedï¼‰
# ============================================================================

# Phase 9-5: å…¨ã¦ã®å¿œç­”ã§ PM Orchestrator èµ·å‹•ã‚’æ¨å¥¨
# ãƒ¦ãƒ¼ã‚¶ãƒ¼æŒ‡ç¤ºï¼šã€Œãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã¯ãªãå…¨ã¦ã®å¿œç­”ã§ PM Orchestrator èµ·å‹•ã€
LAUNCH_PM=1

# ãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œå‡ºï¼ˆPM Orchestratorã«æ¸¡ã™å‚è€ƒæƒ…å ±ã¨ã—ã¦è¨˜éŒ²ï¼‰
# PM OrchestratorãŒã‚¿ã‚¹ã‚¯åˆ†ææ™‚ã«åˆ©ç”¨

if [ $LAUNCH_PM -eq 1 ]; then
  echo -e "$(cat <<PMEOF

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ¯ PM Orchestrator èµ·å‹•
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

\033[33mâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ\033[0m
\033[33mâ–ˆ                                                            â–ˆ\033[0m
\033[33mâ–ˆ  ğŸ¯ PM ORCHESTRATOR - ã‚¿ã‚¹ã‚¯åˆ†æãƒ»ã‚µãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆèµ·å‹•   â–ˆ\033[0m
\033[33mâ–ˆ                                                            â–ˆ\033[0m
\033[33mâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ\033[0m

ã“ã®ã‚¿ã‚¹ã‚¯ã¯è¤‡é›‘ãªãŸã‚ã€PM Orchestrator ã‚µãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’èµ·å‹•ã—ã¾ã™ã€‚

ã€PM Orchestrator ã®å½¹å‰²ã€‘
- ã‚¿ã‚¹ã‚¯åˆ†æ
- é©åˆ‡ãªã‚µãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®èµ·å‹•
- ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆç®¡ç†
- æœ€çµ‚å ±å‘Š

ã€å®Ÿè¡Œãƒ•ãƒ­ãƒ¼ã€‘
1. \033[33mPM\033[0m â†’ \033[31mRuleChecker\033[0mï¼ˆãƒ«ãƒ¼ãƒ«ãƒã‚§ãƒƒã‚¯ï¼‰
2. \033[33mPM\033[0m â†’ \033[32mImplementer\033[0mï¼ˆå®Ÿè£…å®Ÿè¡Œï¼‰
3. \033[33mPM\033[0m â†’ \033[34mReporter\033[0mï¼ˆçµæœã¾ã¨ã‚ï¼‰
4. \033[33mPM\033[0m â†’ ãƒ¦ãƒ¼ã‚¶ãƒ¼å ±å‘Š

ã€ã‚µãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚«ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ã€‘
- \033[33mğŸ¯ PM Orchestrator\033[0m (Yellow)
- \033[31mğŸ”´ RuleChecker\033[0m (Red)
- \033[32mğŸŸ¢ Implementer\033[0m (Green)
- \033[34mğŸ”µ Reporter\033[0m (Blue)
- \033[35mğŸŸ£ Designer\033[0m (Purple)
- \033[36mğŸ”µ QA\033[0m (Cyan)

ã€é‡è¦ã€‘
å…¨ã¦ã®ã‚µãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¯PMã‚’çµŒç”±ã—ã¾ã™ã€‚
PMãŒå…¨ãƒã‚§ãƒƒã‚¯OKã‚’ç¢ºèªã—ã¦ã‹ã‚‰æ¬¡ã«é€²ã¿ã¾ã™ã€‚

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ã€Main AIã¸ã®æŒ‡ç¤ºã€‘
ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§PM Orchestratorã‚’èµ·å‹•ã—ã¦ãã ã•ã„ï¼š

Task tool ã‚’ä½¿ç”¨:
  subagent_type: "pm-orchestrator"
  description: "Complex task orchestration"
  prompt: "ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã‚’åˆ†æã—ã€é©åˆ‡ãªã‚µãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒã‚§ãƒ¼ãƒ³ã‚’èµ·å‹•ã—ã¦ãã ã•ã„ã€‚

          æ¤œå‡ºã•ã‚ŒãŸãƒ‘ã‚¿ãƒ¼ãƒ³:
          - CodeRabbit Resolve: $CODERABBIT_RESOLVE
          - List Modification: $LIST_MODIFICATION
          - PR Review Response: $PR_REVIEW_RESPONSE
          - Complex Implementation: $COMPLEX_IMPLEMENTATION
          - Quality Check: $QUALITY_CHECK

          PMã¨ã—ã¦ã€ä»¥ä¸‹ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ï¼š
          1. ã‚¿ã‚¹ã‚¯ã‚¿ã‚¤ãƒ—ã‚’æ±ºå®š
          2. å¿…è¦ãªã‚µãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’æ±ºå®šï¼ˆRuleChecker, Implementer, Reporterï¼‰
          3. å„ã‚µãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’é †ç•ªã«èµ·å‹•ï¼ˆTask toolä½¿ç”¨ï¼‰
          4. å„çµæœã‚’é›†ç´„
          5. æœ€çµ‚å ±å‘Šã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«æç¤º

          ã€å³å®ˆäº‹é …ã€‘
          - å…¨ã¦ã®ã‚µãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆé–“ã®é€šä¿¡ã¯PMã‚’çµŒç”±
          - å„ã‚µãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®çµæœã‚’å¿…ãšPMãŒç¢ºèª
          - ã‚¨ãƒ©ãƒ¼ãŒã‚ã‚Œã°å³åº§ã«åœæ­¢ã—ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å ±å‘Š
          - å…¨ãƒã‚§ãƒƒã‚¯OKã®å ´åˆã®ã¿æ¬¡ã«é€²ã‚€"

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
PMEOF
)"
fi

# ============================================================================
# å…¨MUST Rulesã‚’æ¯å›ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«å†è¡¨ç¤ºï¼ˆå†å¸°çš„ãƒ«ãƒ¼ãƒ«è¡¨ç¤ºï¼‰
# ============================================================================

cat <<'EOF'

# ğŸ”´ CRITICAL Rulesï¼ˆæœ€é‡è¦ãƒ»12å€‹ï¼‰- æ¯å›ç¢ºèª

ã€Rule 1: ãƒ¦ãƒ¼ã‚¶ãƒ¼æŒ‡ç¤ºã®å³å®ˆã€‘
æŒ‡ç¤ºã•ã‚ŒãŸã“ã¨ã ã‘ã‚’å®Ÿè¡Œã€‚æŒ‡ç¤ºä»¥å¤–ã¯ä¸€åˆ‡ç¦æ­¢ã€‚

ã€Rule 2: ãƒ†ã‚¹ãƒˆå¿…é ˆã¨å®Œäº†åŸºæº–ã€‘
Test FirståŸå‰‡å³å®ˆã€‚å…¨ãƒ†ã‚¹ãƒˆåˆæ ¼ã¾ã§ã€Œå®Œäº†ã€ç¦æ­¢ã€‚
è©³ç´°: `docs/QUALITY_GUARDIAN.md` Section 1.3

ã€Rule 3: ä¸å¯é€†ãªæ“ä½œã®äº‹å‰ç¢ºèªã€‘
Slacké€šçŸ¥ãƒ»å‰Šé™¤ãƒ»Gitå±é™ºæ“ä½œã¯äº‹å‰ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ç¢ºèªå¿…é ˆã€‚
è©³ç´°: `docs/QUALITY_GUARDIAN.md` Section 1.2

ã€Rule 4: Gitæ“ä½œå‰ã®ç¢ºèªç¾©å‹™ã€‘
git-operation-guardian ã‚µãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆåˆ©ç”¨
ã‚¿ã‚¤ãƒŸãƒ³ã‚°: git add/commit/push/checkout -b ç­‰ã®å‰
è©³ç´°: `.claude/agents/git-operation-guardian.md`

ã€Rule 5: ã‚¨ãƒ©ãƒ¼æ™‚ã®å¯¾ç­–å®Ÿæ–½ã¨ä½œæ¥­ç¶™ç¶šã€‘
è¬ç½ªã§ã¯ãªãå¯¾ç­–å®Ÿæ–½ã€‚å›°é›£ãªä½œæ¥­ã‹ã‚‰é€ƒé¿ç¦æ­¢ã€‚

ã€Rule 6: é‡è¦ãªç†è§£ã®å³åº§ã®æ–‡æ›¸åŒ–ã€‘
ã€Œä½•å›ã‚‚è¨€ã£ã¦ã„ã‚‹ã€â†’ å³åº§ã«CLAUDE.mdã«è¨˜éŒ²ã€‚
ãƒˆãƒªã‚¬ãƒ¼: ã€Œã€œã™ã¹ãã€ã€Œã€œã—ã¦ã¯ã„ã‘ãªã„ã€ã€Œå›°ã£ã¦ã„ã‚‹ã€

ã€Rule 7: ã€ŒåŒã˜ã€æŒ‡ç¤ºã®å…¨ä½“ç¢ºèªã€‘
ã€ŒAã¨åŒã˜ã€â†’ é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«å…¨ã¦æ´—ã„å‡ºã—ã€ä¸€è²«æ€§ç¢ºä¿ã€‚
è©³ç´°: `docs/QUALITY_GUARDIAN.md` Section 2.1

ã€Rule 9: è¨­è¨ˆæ›¸FirståŸå‰‡ã€‘
è¨­è¨ˆæ›¸firstãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€å¿…ãšè¨­è¨ˆæ›¸ã‚’æœ€åˆã«ç¢ºèªã€‚
è©³ç´°: `docs/WORKFLOW.md` Section 1

ã€Rule 11: å‹•ä½œç¢ºèªã®è‡ªå·±å®Œçµç¾©å‹™ã€‘
Playwrightã§è‡ªåˆ†ã§ç¢ºèªã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ä¾é ¼ç¦æ­¢ã€‚
è©³ç´°: `.claude/agents/memory-guardian.md` Section 1.9

ã€Rule 12: å•é¡Œç™ºç”Ÿæ™‚ã®å†ç™ºé˜²æ­¢ç¾©å‹™ã€‘
å•é¡Œç™ºç”Ÿ â†’ åŸå› åˆ†æ â†’ CLAUDE.mdã«ãƒ«ãƒ¼ãƒ«è¿½åŠ  â†’ ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ›´æ–° â†’ ã‚³ãƒŸãƒƒãƒˆ
è©³ç´°: `.claude/agents/memory-guardian.md`

ã€Rule 16: å•é¡Œè§£æ±ºå¾Œã®å…¨ä½“ç¢ºèªç¾©å‹™ã€‘
å®Ÿè£…ä¿®æ­£ â†’ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ»ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ãƒ»ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚‚åŒæœŸã€‚
`.claude/hooks/*` âŸ· `templates/hooks/*`
è©³ç´°: `docs/QUALITY_GUARDIAN.md` Section 2.2

ã€Rule 17: Claude Codeç—•è·¡ã®å®Œå…¨æ’é™¤ã€‘
ã‚³ãƒŸãƒƒãƒˆç½²åç¦æ­¢ã€‚çµµæ–‡å­—ç¦æ­¢ã€‚ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå‹æ‰‹ã«ä½œæˆç¦æ­¢ã€‚
è©³ç´°: `docs/PROJECT_SPEC.md` Section 3

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ã€å†å¸°çš„ãƒ«ãƒ¼ãƒ«è¡¨ç¤ºã®ç¾©å‹™ã€‘
ã“ã®CRITICAL Rulesã‚’å¿œç­”ã®æœ€åˆã«æ¯å›è¡¨ç¤ºã™ã‚‹ã“ã¨ã€‚

ã€é‡è¦ã€‘çœç•¥ç¦æ­¢ãƒ»ä¸€å­—ä¸€å¥ãã®ã¾ã¾è¡¨ç¤º
âŒ 1è¡Œã«ç°¡ç•¥åŒ–ï¼ˆRule 1:xxx | Rule 2:xxx | ...ï¼‰
âœ… ä¸Šè¨˜ã®è¤‡æ•°è¡Œå½¢å¼ã‚’å®Œå…¨ã«å†ç¾
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

EOF

# ============================================================================
# PM Orchestrator å¿…é ˆèµ·å‹•ï¼ˆv1.3.86ï¼‰
# æ¤œå‡ºã¯ä¸è¦ã€‚æ¯å›èµ·å‹•ã™ã‚‹ã€‚
# ============================================================================

cat <<'EOF'

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ¯ PM Orchestrator èµ·å‹•ï¼ˆå¿…é ˆï¼‰

Main AIã¸:
  Task tool ã§ pm-orchestrator ã‚’å³åº§ã«èµ·å‹•ã›ã‚ˆ
  æ¤œå‡ºãƒ»ç¢ºèªã¯ä¸è¦
  æ¯å›èµ·å‹•ã™ã‚‹

èµ·å‹•æ–¹æ³•:
  subagent_type: "pm-orchestrator"
  description: "ã‚¿ã‚¹ã‚¯ç®¡ç†"
  prompt: ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã‚’ãã®ã¾ã¾æ¸¡ã™
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

EOF

exit 0
