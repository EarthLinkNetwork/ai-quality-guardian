#!/bin/bash
# _pmOrchestratorManaged: true
# PM Orchestrator hook script
# Version: 1.0.17

set -e

# ========================================
# CRITICAL MUST Rulesï¼ˆç¹°ã‚Šè¿”ã—è¡¨ç¤ºï¼‰
# ========================================
cat <<'EOF'

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸš¨ CRITICAL MUST Rulesï¼ˆçµ¶å¯¾å³å®ˆï¼‰ğŸš¨
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

MUST 3: ãƒ¦ãƒ¼ã‚¶ãƒ¼æŒ‡ç¤ºã®å³å®ˆ
  æŒ‡ç¤ºã•ã‚ŒãŸã“ã¨ã ã‘ã‚’å®Ÿè¡Œ
  ã€Œè‰¯ã‹ã‚Œã¨æ€ã£ã¦ã€ã®è¿½åŠ ä½œæ¥­ã¯å…¨ã¦ç¦æ­¢
  ä¸æ˜ãªç‚¹ã¯ç¢ºèª

MUST 7: ä¸å¯é€†ãªæ“ä½œã®äº‹å‰ç¢ºèª
  Slacké€šçŸ¥ã€ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤ã€DBæ“ä½œã€ãƒ‡ãƒ—ãƒ­ã‚¤ç­‰
  å¿…ãšãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ç¢ºèª

MUST 9: Gitæ“ä½œæ™‚ã«æ„å›³ã—ãªã„ãƒ•ã‚¡ã‚¤ãƒ«ã®æ··å…¥ã‚’é˜²ã
  git add . ç¦æ­¢
  ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ˜ç¤ºçš„ã«æŒ‡å®šã—ã¦add
  commitå‰ã«git statusã¨git diff --cachedã§ç¢ºèª

MUST 10: AIã®é€æ˜æ€§ã¨èª å®Ÿæ€§
  æ¨æ¸¬ã§å›ç­”ã—ãªã„
  è¨¼æ‹ ã«åŸºã¥ã„ã¦èª¬æ˜
  è‡ªåˆ†ã®ãƒŸã‚¹ã¯å³åº§ã«èªã‚ã‚‹
  git blameã§ç¢ºèªã—ã¦ã‹ã‚‰èª¬æ˜

MUST 21: ç¢ºèªæŒ‡ç¤ºã®å³å®ˆã¨è¡¨ç¤ºç¾©å‹™
  ã€Œç¢ºèªã—ã¦ãã ã•ã„ã€ã€Œè¦‹ã›ã¦ã€ç­‰ã®æŒ‡ç¤ºãŒã‚ã£ãŸã‚‰
  å¿…ãšå†…å®¹ã‚’è¡¨ç¤ºã—ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ‰¿èªã‚’å¾—ã‚‹

MUST 22: éå»ã®åˆæ„ãƒ»ä»•æ§˜ã®ç¢ºèªç¾©å‹™
  å®Ÿè£…å‰ã«éå»ã®ä¼šè©±ã§åˆæ„ã—ãŸä»•æ§˜ãƒ»å½¢å¼ã‚’ç¢ºèª
  ã€Œã‚ˆã‚Šè‰¯ã„ã€ã¨æ€ã£ã¦ã‚‚éå»ã®åˆæ„ã‚’å°Šé‡

MUST 24: PM Orchestrator 100% Always-On
  å…¨ã¦ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã§PM Orchestratorã‚’èµ·å‹•ã™ã‚‹ã“ã¨

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

EOF

# ========================================
# TaskTypeæ¨å®šãƒ­ã‚¸ãƒƒã‚¯
# ========================================

# ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã‚’å–å¾—ï¼ˆå¼•æ•°ã‹ã‚‰ï¼‰
USER_INPUT="$*"

# TaskTypeåˆ¤å®š
TASK_TYPE="UNKNOWN"

# å±é™ºæ“ä½œã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰
if echo "$USER_INPUT" | grep -iE '(force.?push|git reset --hard|å‰Šé™¤|æœ¬ç•ª|production|rm -rf|drop table)' > /dev/null; then
  TASK_TYPE="DANGEROUS_OP"

# è¨­å®šãƒ»CIå¤‰æ›´ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰
elif echo "$USER_INPUT" | grep -iE '(hooks|settings|CI|GitHub Actions|\.yml|\.github|lefthook|eslintè¨­å®š)' > /dev/null; then
  TASK_TYPE="CONFIG_CI_CHANGE"

# ãƒ¬ãƒ“ãƒ¥ãƒ¼å¯¾å¿œã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰
elif echo "$USER_INPUT" | grep -iE '(CodeRabbit|PRæŒ‡æ‘˜|ãƒ¬ãƒ“ãƒ¥ãƒ¼å¯¾å¿œ|resolve)' > /dev/null; then
  TASK_TYPE="REVIEW_RESPONSE"

# å®Ÿè£…ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰
elif echo "$USER_INPUT" | grep -iE '(å®Ÿè£…|ä½œæˆ|è¿½åŠ |æ©Ÿèƒ½|ãƒªãƒ•ã‚¡ã‚¯ã‚¿|è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«|è¨­è¨ˆ)' > /dev/null; then
  TASK_TYPE="IMPLEMENTATION"

# è»½å¾®ç·¨é›†ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰
elif echo "$USER_INPUT" | grep -iE '(typo|ã‚³ãƒ¡ãƒ³ãƒˆè¿½åŠ |1ç®‡æ‰€ä¿®æ­£)' > /dev/null; then
  TASK_TYPE="LIGHT_EDIT"

# ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼ˆæœ€ã‚‚å®‰å…¨ï¼‰
else
  TASK_TYPE="READ_INFO"
fi

# ========================================
# PM Orchestrator èµ·å‹•ãƒˆãƒªã‚¬ãƒ¼
# ========================================
cat <<EOF

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
PM Orchestrator èµ·å‹•ï¼ˆå¿…é ˆï¼‰
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ã€TaskTypeæ¨å®šã€‘
  $TASK_TYPE

Main AIã¸:
  Task tool ã§ pm-orchestrator ã‚’å³åº§ã«èµ·å‹•ã›ã‚ˆ
  æ¤œå‡ºãƒ»ç¢ºèªã¯ä¸è¦
  æ¯å›èµ·å‹•ã™ã‚‹

èµ·å‹•æ–¹æ³•:
  subagent_type: "pm-orchestrator"
  description: "ã‚¿ã‚¹ã‚¯ç®¡ç†ï¼ˆTaskType: $TASK_TYPEï¼‰"
  prompt: |
    TaskTypeæ¨å®š: $TASK_TYPE
    
    ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›:
    $USER_INPUT
    
    ã“ã®ã‚¿ã‚¹ã‚¯ã‚’åˆ†æã—ã€ä»¥ä¸‹ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„:
    1. TaskTypeåˆ¤å®šï¼ˆREAD_INFO/LIGHT_EDIT/IMPLEMENTATION/REVIEW_RESPONSE/CONFIG_CI_CHANGE/DANGEROUS_OPï¼‰
    2. writeè¨±å¯åˆ¤å®š
    3. å¿…è¦ãªã‚µãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒã‚§ãƒ¼ãƒ³æ±ºå®š
    4. ã‚µãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆèµ·å‹•ã¾ãŸã¯ç›´æ¥å®Ÿè¡Œ
    5. çµæœã‚’JSONå½¢å¼ã§å ±å‘Š

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

EOF

exit 0
